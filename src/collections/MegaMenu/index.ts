import type { CollectionConfig } from 'payload'
import { revalidateTag } from 'next/cache'

export const MegaMenu: CollectionConfig = {
  slug: 'mega-menu',
  labels: { singular: 'MegaMenu Item', plural: 'MegaMenu Items' },
  admin: {
    defaultColumns: ['label', 'url', 'order'],
    useAsTitle: 'label',
    group: 'Navigation',
  },
  access: {
    read: () => true,
  },
  hooks: {
    afterChange: [() => revalidateTag('mega-menu')],
    afterDelete: [() => revalidateTag('mega-menu')],
  },
  fields: [
    {
      name: 'label',
      type: 'text',
      required: true,
      label: 'Label',
    },
    {
      name: 'url',
      type: 'text',
      required: true,
      label: 'URL',
      admin: { description: 'z. B. /leistungen oder https://...' },
    },
    {
      name: 'order',
      type: 'number',
      required: true,
      defaultValue: 0,
      label: 'Reihenfolge',
      admin: { description: 'Sortierung (Drag & Drop im Listen-View).' },
    },
    {
      name: 'icon',
      type: 'upload',
      relationTo: 'media',
      label: 'Icon',
      admin: { description: 'Optionales Icon neben dem Label (z. B. für die Hauptnavigation).' },
    },
    {
      name: 'image',
      type: 'upload',
      relationTo: 'media',
      label: 'Bild',
      admin: { description: 'Optionales Bild im Dropdown (z. B. Teaser oder großes Bild).' },
    },
    {
      name: 'appearance',
      type: 'select',
      label: 'Darstellung',
      defaultValue: 'link',
      options: [
        { label: 'Normaler Link', value: 'link' },
        { label: 'Als Button/Badge', value: 'button' },
      ],
      admin: {
        description: 'Top-Level-Eintrag als normalen Link oder als hervorgehobenen Button/Badge anzeigen.',
      },
    },
    {
      name: 'subItems',
      type: 'array',
      label: 'Submenu-Einträge',
      minRows: 0,
      admin: { description: 'Einfache Liste unter dem Haupt-Label.' },
      fields: [
        { name: 'label', type: 'text', required: true, label: 'Label' },
        { name: 'url', type: 'text', required: true, label: 'URL' },
        {
          name: 'icon',
          type: 'upload',
          relationTo: 'media',
          label: 'Icon',
          admin: { description: 'Kleines Icon (z. B. 16×16).' },
        },
        {
          name: 'image',
          type: 'upload',
          relationTo: 'media',
          label: 'Bild',
          admin: { description: 'Größeres Bild statt oder neben Icon.' },
        },
        {
          name: 'badge',
          type: 'text',
          label: 'Badge',
          admin: { description: 'Kurzer Text für Badge (z. B. "Neu", "Pro").' },
        },
        {
          name: 'badgeColor',
          type: 'select',
          label: 'Badge-Farbe',
          defaultValue: 'success',
          options: [
            { label: 'Success (Blau)', value: 'success' },
            { label: 'Muted (Grau)', value: 'muted' },
            { label: 'Accent', value: 'accent' },
            { label: 'Warning (Orange)', value: 'warning' },
            { label: 'Error (Rot)', value: 'error' },
          ],
          admin: { description: 'Farbe des Badges.' },
        },
        { name: 'description', type: 'textarea', label: 'Beschreibung' },
        {
          name: 'dividerBefore',
          type: 'checkbox',
          label: 'Trennlinie davor',
          defaultValue: false,
          admin: { description: 'Zeigt eine Trennlinie vor diesem Eintrag.' },
        },
      ],
    },
    {
      name: 'columns',
      type: 'array',
      label: 'Spalten (Mega-Dropdown)',
      minRows: 0,
      admin: { description: 'Mehrspaltiges Dropdown mit optionalem Spaltentitel.' },
      fields: [
        { name: 'title', type: 'text', label: 'Spaltentitel' },
        {
          name: 'dividerBefore',
          type: 'checkbox',
          label: 'Trennlinie davor',
          defaultValue: false,
          admin: { description: 'Zeigt eine vertikale Trennlinie vor dieser Spalte.' },
        },
        {
          name: 'columnBackground',
          type: 'select',
          label: 'Hintergrund der Spalte',
          defaultValue: 'default',
          options: [
            { label: 'Standard', value: 'default' },
            { label: 'Abgesetzt (muted)', value: 'muted' },
            { label: 'Abgesetzt (accent)', value: 'accent' },
          ],
          admin: { description: 'Optional anderer Hintergrund, um die Spalte visuell abzusetzen.' },
        },
        {
          name: 'items',
          type: 'array',
          label: 'Einträge',
          fields: [
            { name: 'label', type: 'text', required: true, label: 'Label' },
            { name: 'url', type: 'text', required: true, label: 'URL' },
            { name: 'description', type: 'textarea', label: 'Beschreibung', admin: { description: 'Kurzer Text unter dem Label (z. B. Attio-Stil).' } },
            {
              name: 'icon',
              type: 'upload',
              relationTo: 'media',
              label: 'Icon',
              admin: { description: 'Kleines Icon.' },
            },
            {
              name: 'image',
              type: 'upload',
              relationTo: 'media',
              label: 'Bild',
              admin: { description: 'Bild (z. B. Vorschaubild).' },
            },
            {
              name: 'badge',
              type: 'text',
              label: 'Badge',
              admin: { description: 'Kurzer Text für Badge (z. B. "Neu", "Pro").' },
            },
            {
              name: 'badgeColor',
              type: 'select',
              label: 'Badge-Farbe',
              defaultValue: 'success',
              options: [
                { label: 'Success (Blau)', value: 'success' },
                { label: 'Muted (Grau)', value: 'muted' },
                { label: 'Accent', value: 'accent' },
                { label: 'Warning (Orange)', value: 'warning' },
                { label: 'Error (Rot)', value: 'error' },
              ],
              admin: { description: 'Farbe des Badges.' },
            },
          ],
        },
      ],
    },
    {
      name: 'highlight',
      type: 'group',
      label: 'Highlight-Block',
      admin: { description: 'Optionaler hervorgehobener Block im Dropdown (z. B. CTA).' },
      fields: [
        { name: 'title', type: 'text', label: 'Titel' },
        { name: 'description', type: 'textarea', label: 'Beschreibung' },
        {
          name: 'image',
          type: 'upload',
          relationTo: 'media',
          label: 'Bild',
        },
        { name: 'ctaLabel', type: 'text', label: 'Button-Text' },
        { name: 'ctaUrl', type: 'text', label: 'Button-URL' },
      ],
    },
  ],
}
